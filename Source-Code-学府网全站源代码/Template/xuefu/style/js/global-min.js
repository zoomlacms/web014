var TB=KISSY.app("TB");TB.add("mod~global",function(){var f=KISSY,m=!"0"[0],u=m&&!window.XMLHttpRequest,v=!!window.ActiveXObject,I=document,e=window,n,t,l=" ",q="hover",j,x="g_config" in e?("appId" in e.g_config?parseInt(e.g_config["appId"]):undefined):undefined,b="mini-cart",k="mini-cart-no-layer",p=location.hostname.split("."),J=I.domain,d=J.indexOf("tmall.com")>-1,z=~location.hostname.indexOf("daily.taobao.net")||~location.hostname.indexOf("daily.tmall.net"),s=z?".daily.taobao.net":".taobao.com",H="",a=false,A=(I.location.href.indexOf("https://")===0),E={},c={siteNav:function(){if(!j){return}j.setAttribute("role","navigation");f.each(G("menu","*",j),function(O){TB.Global._addMenu(O)});var N=I.forms.topSearch;y(N,"submit",function(){if(N.q.value==H){N.action="http://list.taobao.com/browse/cat-0.htm"}});var i=G("cart","li",j)[0];y(i,"click",function(P){var O=P.target||P.srcElement;if(O.nodeName!="A"&&O.parentNode.nodeName==="A"){O=O.parentNode}if(O.nodeName==="A"&&O.href.indexOf("my_cart.htm")>-1){h(P);r(i,"hover");TB.Cart&&TB.Cart.redirect(O,O.href);if(e.MiniCart){e.MiniCart._clicked=false}}});var K="g_mytaobao_set_dynamic_count";var L=false;var M=G("mytaobao","li",j)[0];y(M,"mouseover",function(P){if(L){return}if(!TB.Global.isLogin()){return}L=true;window[K]=function(Q){if(!Q||!Q[5]||Q[5]==0){return}el=document.getElementById("myTaobaoPanel").getElementsByTagName("a")[2];el.innerHTML+='<span style="color:#f50;"> '+Q[5]+"</span>"};var O="http://i"+s+"/json/my_taobao_remind_data.htm?from=site&t=";f.getScript(O+f.now()+"&callback="+K)})},tDog:function(){if((x&&x!=-1)||"tstart" in t||"tdog" in t){var i="http://"+n+"/p/header/webww-min.js?t=20110629.js",K=0;f.ready(function(){if(f.DOM){f.getScript(i)}else{if(K<10){setTimeout(arguments.callee,1000);K++}else{f.use("core",function(){f.getScript(i)})}}})}},tLabs:function(){if(location.href.indexOf("tms.taobao.com")!==-1){return}f.ready(function(){var K="http://"+n+"/p/tlabs/1.0.0/tlabs-min.js?t=1.0.0.js",i=F("_nk_")||F("tracknick");i=encodeURIComponent(w(unescape(i.replace(/\\u/g,"%u"))));f.getScript(K,function(){if(typeof TLabs!=="undefined"){TLabs.init({nick:i})}})})},POCMonitor:function(){var O=e._poc||[],N,L=0,K=[["_setAccount",(e.g_config||0).appId],["_setStartTime",(e.g_config||0).startTime||e.HUBBLE_st||e.g_hb_monitor_st]],M=10000;while((N=O[L++])){if(N[0]==="_setRate"){M=N[1]}else{if(N[0]==="_setAccount"){K[0]=N}else{if(N[0]==="_setStartTime"){K[1]=N}else{K.push(N)}}}}if(parseInt(Math.random()*M)===0){e._poc=K;f.getScript("http://a.tbcdn.cn/p/poc/m.js?v=0.0.1.js")}},initHeaderLinks:function(){if(J.indexOf(".taobao.net")===-1){return}var M=j?j.getElementsByTagName("a"):[],L=0,K=M.length,N=p;while(N.length>3){N.shift()}N=N.join(".");for(;L<K;L++){M[L].href=M[L].href.replace("taobao.com",N)}},initLogout:function(){var i=I.getElementById("#J_Logout");if(!i){return}y(i,"click",function(L){L.halt();var K=i.href;new Image().src="//taobao.alipay.com/user/logout.htm";setTimeout(function(){location.href=K},20)})},initSiteNav:function(){var L=I.getElementById("J_Service"),K=I.getElementById("J_ServicesContainer"),N,i="http://www.taobao.com/index_inc/2010c/includes/get-services.php",O="__services_results";if(!L||!K){return}y(L,"mouseover",M);y(L,"keydown",M);function M(P){if(P.type==="keydown"&&P.keyCode!==39&&P.keyCode!==40){return}N=f.getScript(i+"?cb="+O,{charset:"gbk"});h(P)}window[O]=function(P){if(N){N.parentNode.removeChild(N)}N=null;try{K.innerHTML=P;K.style.height="auto";B(L,"mouseover",M);B(L,"keydown",M)}catch(Q){K.style.display="none"}}},test:function(){var i=false;var K=function(){if(i){return}i=true;if(location.href.indexOf("__cloudyrun__")>-1){f.getScript("http://assets.daily.taobao.net/p/cloudyrun/1.0/cloudyrun-taobao-pkg.js?t="+(+new Date()))}};f.ready(K);setTimeout(K,4000)},assist:function(){if(F("test_accouts")&&document.domain.indexOf("taobao.net")>-1){f.ready(function(){f.getScript("http://assets.daily.taobao.net/p/assist/login/login.js")})}},miniCart:function(){var i=TB.Global;if(i._OFF){return}if(d||J.indexOf("tmall.net")>-1){if(f.isUndefined(x)){return}else{if(!(F("uc2")&&F("mt"))){f.getScript("http://www"+s+"/go/app/tmall/login-api.php?t="+f.now());return}}}i.initMiniCart()},mpp:function(){f.getScript("http://"+n+"/p/tstart/1.0/build/tb-mpp-min.js?t=201107210.js",function(){f.ready(function(){if(!TB.Global.isLogin()){return}Mpp.Notify.register({appId:1010,type:1,callback:function(){f.getScript("http://"+(z?"webww.daily.taobao.net:8080":"webwangwang.taobao.com")+"/getOtherSystem.do?callback=TB.Global.setUserMsg&t="+f.now())}})})})}};var D=["tDog","tLabs","test","mpp"];for(var C=0;C<D.length;C++){(function(K){var i=c[K];c[K]=function(){setTimeout(i,1000)}})(D[C])}TB.Global={_addMenu:function(N){if(!N){return}var K=this,O=G("menu-hd","*",N)[0],M=G("menu-bd","*",N)[0];if(!M||!O){return}O.tabIndex=0;K._subMenus.push(M);M.setAttribute("role","menu");M.setAttribute("aria-hidden","true");if(!M.getAttribute("id")){M.setAttribute("id",f.guid("menu-"))}O.setAttribute("aria-haspopup",M.getAttribute("id"));O.setAttribute("aria-label","\u53f3\u952e\u5f39\u51fa\u83dc\u5355\uff0ctab\u952e\u5bfc\u822a\uff0cesc\u5173\u95ed\u5f53\u524d\u83dc\u5355");var L=false;if(!A&&u){L=I.createElement("iframe");L.src="about: blank";L.className="menu-bd";N.insertBefore(L,M)}y(N,"mouseover",function(Q){var P=Q.relatedTarget;while(P&&P!==N){P=P.parentNode}if(P!==N){f.each(K._subMenus,function(R){if(R!==M){r(R.parentNode,q);R.setAttribute("aria-hidden","true")}});o(N,q);M.setAttribute("aria-hidden","false");if(!L){return}L.style.height=parseInt(M.offsetHeight)+25+"px";L.style.width=parseInt(M.offsetWidth)+1+"px"}});y(N,"mouseout",function(Q){var P=Q.relatedTarget;while(P&&P!==N){P=P.parentNode}if(P!==N){r(N,q);M.setAttribute("aria-hidden","true");f.each(M.getElementsByTagName("input"),function(R){if(R.getAttribute("type")!=="hidden"){R.blur()}})}});y(N,"keydown",function(Q){var P=Q.keyCode;if(P==27||P==37||P==38){r(N,q);M.setAttribute("aria-hidden","true");O.focus();h(Q)}else{if(P==39||P==40){o(N,q);M.setAttribute("aria-hidden","false");h(Q)}}});var i;y(N,v?"focusin":"focus",function(){if(i){clearTimeout(i);i=null}},!v);y(N,v?"focusout":"blur",function(){i=setTimeout(function(){r(N,q);M.setAttribute("aria-hidden","true")},100)},!v)},init:function(i){if(a){return}a=true;n=z?"assets.daily.taobao.net":"a.tbcdn.cn";t=f.unparam(location.search.substring(1));j=I.getElementById("site-nav");this._OFF=!!!j;this.config=i;if(i&&i.mc&&i.mc===-1){this._OFF=true}if(window.top!==window.self){this._OFF=true}this._subMenus=[];for(var K in c){c[K]()}if(~location.search.indexOf("__test__=global.js")){f.ready(function(){f.later(L,3000)});function L(){var M=["Light","TLabs"];for(var N=0;N<M.length;N++){if(typeof M==="undefined"){alert("test case: failure");return}}alert("test case: success")}}},writeLoginInfo:function(ae,N){ae=ae||{};var T=this,ad=F("_nk_")||F("tracknick"),L=g(F("uc1")),Y=parseInt(L._msg_)||0,Q=f.now(),S="http://login.taobao.com",i=ae.memberServer||"http://member1.taobao.com",aa=ae.outmemServer||"http://outmem.taobao.com",K=ae.loginServer||"https://login.taobao.com",U=ae.loginUrl||K+"/member/login.jhtml?f=top",O=location.href,V,ab,M,ac,Z,R=H;if(/^http.*(\/member\/login\.jhtml)$/i.test(O)){O=H}V=ae.redirectUrl||O;if(V){U+="&redirectURL="+encodeURIComponent(V)}ab=ae.logoutUrl||S+"/member/logout.jhtml?f=top&out=true&redirectURL="+encodeURIComponent(V);M=i+"/member/newbie.htm";ac=aa+"/message/list_private_msg.htm?t="+Q;Z="http://i.taobao.com/my_taobao.htm?t="+Q;if(T.isLogin()){R='hi\uff0c<a class="user-nick" href="'+Z+'" target="_top">'+w(unescape(ad.replace(/\\u/g,"%u")))+"</a>\uff01"+T.showVIP()+'<a id="J_Logout" href="'+ab+'" target="_top">\u9000\u51fa</a><a href="'+ac+'" target="_top">\u7ad9\u5185\u4fe1';if(Y){R+="("+Y+")"}R+="</a>"}else{R='\u4eb2\uff0c\u6b22\u8fce\u6765\u6dd8\u5b9d\uff01\u8bf7<a href="'+U+'" target="_top">\u767b\u5f55</a>';R+='<a href="'+M+'" target="_top">\u514d\u8d39\u6ce8\u518c</a>'}if(N){var P=document.getElementById("site-nav");if(P){var W=P.getElementsByTagName("p")[0];if(W&&W.className==="login-info"){W.innerHTML=R}}return}I.write(R);if(T.showVIP().length<1){return}var X=document.getElementById("J_Vip_Areas");if(u){y(X,"mouseover",function(af){o(X,"vip-areas-hover")});y(X,"mouseout",function(af){r(X,"vip-areas-hover")})}},showVIP:function(){var i=parseInt(g(F("uc1"))["tag"])||-1,L=H,M=H,K="http://vip"+s;if(f.indexOf(i,[1,2,3,4,5,6])>-1){if(i>2){M='<a class="vip-my-service" href="http://service.taobao.com/support/minerva/robot_main.htm?dcs=2&sourceId=400&businessId=100&moduleGroupId=taobaocrm" rel="nofollow" target="_top"></a>'}L='<span class="vip-areas" id="J_Vip_Areas"><a class="vip-icon'+i+'" id="J_VipIcon" rel="nofollow" target="_top" href="http://vip.taobao.com/"></a><span class="vip-content"><b></b><a class="vip-toy-icon'+i+'" href="http://vip.taobao.com/growth_info.htm" rel="nofollow" target="_top"></a><span class="vip-my-level">\u6211\u7684\u7b49\u7ea7\uff1a<a class="vip-my-level'+i+'" target="_top" href="http://vip.taobao.com/growth_info.htm" rel="nofollow" target="_top"></a></span><a class="vip-my-power" href="http://vip.taobao.com/growth_info.htm" rel="nofollow" target="_top">\u67e5\u770b\u6211\u7684\u4f1a\u5458\u7279\u6743</a>'+M+"</span></span>"}else{if(i===7){L='<span class="vip-areas" id="J_Vip_Areas"><a class="vip-icon'+i+'" id="J_VipIcon" rel="nofollow" target="_top" href="http://vip.taobao.com"></a></span>'}else{if(i===0){L='<span class="vip-areas" id="J_Vip_Areas"><a class="vip-icon'+i+'" id="J_VipIcon" rel="nofollow" target="_top" href="http://vip.taobao.com/"></a></span>'}}}return L},isLogin:function(){var K=F("tracknick"),i=F("_nk_")||K;return !!(F("_l_g_")&&i||F("ck1")&&K)},getCartElem:function(){return j&&G("cart","li",j)[0]},initMiniCart:function(){var K=this,O="http://cart"+s+"/top_cart_quantity.htm?",M=function(){f.getScript(O+"callback=TB.Global.setCartNum&t="+f.now()+(x?"&appid="+x:H))};if(K._OFF=(K._OFF||!!!K.getCartElem())){return}var i=g(F("mt")),L,N;if(i&&(L=i.ci)){L=L.split("_");N=parseInt(L[1]);L=parseInt(L[0]);K._OFF=L<0;if(L<0){return}if(K.isLogin()){if(N===0){M()}else{if(N===1){TB.Global.setCartNum(L)}}}else{if(N===0){TB.Global.setCartNum(L)}else{if(N===1){M()}}}}else{M()}},setCartNum:function(L){if(!f.isNumber(L)||TB.Global._OFF){return}var K=TB.Global.getCartElem();if(!K){return}var M=K.getElementsByTagName("a")[0],N='<span class="mini-cart-line"></span><s></s>\u8d2d\u7269\u8f66',i=x!==19;if(L<0){TB.Global._OFF=L===-1;M.innerHTML=N;r(K,b);e.MiniCart&&e.MiniCart.hide();return}M.innerHTML=N+'<span class="mc-count'+(L<10?" mc-pt3":H)+'">'+L+"</span>\u4ef6"+(i?"<b></b>":H);M.href="http://ju.atpanel.com/?url=http://cart"+s+"/my_cart.htm?from=mini&ad_id=&am_id=&cm_id=&pm_id=150042785330be233161";o(K,b);if(!i){o(K,k)}o(K,"menu");o(M,"menu-hd");M.id="mc-menu-hd";if(e.MiniCart){e.MiniCart.cartNum=L;e.MiniCart.isExpired=true}else{f.ready(function(){var O=0;f.getScript("http://"+n+"/p/global/1.0/minicart-min.js?t=20110811.js",function(){if(f.DOM){e.MiniCart.init(L,i)}else{if(O<10){setTimeout(arguments.callee,1000);O++}else{f.use("core",function(){e.MiniCart.init(L,i)})}}})})}},run:function(i){var K=this;K.initMiniCart();if(K.isLogin()){var L=0;f.later(function(){var N=I.getElementById("J_Logout");if(!N){if(L<20){setTimeout(arguments.callee,20);L++}return}var M=K.showVIP();if(M.length<1){return}var O=I.createElement("div");O.innerHTML=M;N.parentNode.insertBefore(O.firstChild,N);K._addMenu(O.firstChild)},30)}},setUserMsg:function(M){if(M.success&&M.success==="true"){var L=f.DOM;if(!L){return}var O=L.get(".login-info",j),N=L.offset(O),K=L.get("#gb-msg-notice"),i;if(!K){K=L.create('<div id="gb-msg-notice"><div class="gb-msg-inner gb-msg-info"><p class="gb-msg-content">'+M.result["messages"][0]+'</p><div class="gb-msg-icon gb-msg-close" title="\u5173\u95ed"></div></div><div class="gb-msg-icon gb-msg-tri"><div class="gb-msg-icon gb-msg-tri-inner"></div></div></div>');L.append(K,j.parentNode);L.offset(K,{left:N.left+30,top:N.top+L.height(O)+1});f.Event.on(K,"click",function(Q){var P=Q.target;if(L.hasClass(P,"gb-msg-close")){L.hide(K)}})}else{i=L.get(".gb-msg-content",K);L.html(i,M.result["messages"][0]);L.show(K)}}}};TB.Cart=f.merge({},{domain:document.domain.indexOf("taobao.net")>-1?"daily.taobao.net":"taobao.com",API:"http://cart.%domain%/check_cart_login.htm",cache:{},popup:null,redirect:function(N,M){var L=f.makeArray(arguments);var O=arguments.callee;var i=this;if(M.indexOf("ct=")===-1&&F("t")){M=M+(M.indexOf("?")===-1?"?":"&")+"ct="+F("t")}if(!f.DOM||!f.Event){f.getScript("http://a.tbcdn.cn/s/kissy/1.1.6/packages/core-min.js",function(){O.apply(i,L)});return}this._addStyleSheetOnce();var K=f.guid();this.cache[K]=f.makeArray(arguments);f.getScript(this.API.replace("%domain%",this.domain)+"?callback=TB.Cart.redirectCallback&guid="+K,{timeout:4000,error:function(){window.top.location.href=M}})},redirectCallback:function(L){var K=L.guid;var i=f.trim(this.cache[K][1]);if(!L.needLogin){window.top.location.href=i;return}if(!K){throw Error("[error] guid not found in callback data")}if(!this.popup){this.popup=this._initPopup()}this._initLoginIframe(i)},hidePopup:function(i){i&&i.preventDefault&&i.preventDefault();f.DOM.css(this.popup,"visibility","hidden")},showPopup:function(){this._centerPopup();f.DOM.css(this.popup,"visibility","visible")},_centerPopup:function(){var i=(f.DOM.viewportHeight()-parseInt(f.DOM.css(this.popup,"height"),10))/2;i=i<0?0:i;f.DOM.css(this.popup,"top",i)},_addStyleSheetOnce:function(){if(!this._stylesheetAdded){f.DOM.addStyleSheet("#g-cartlogin{position:fixed;_position:absolute;border:1px solid #aaa;left:50%;top:120px;margin-left:-206px;width:412px;height:272px;z-index:10001;background:#fafafa;-moz-box-shadow:rgba(0,0,0,0.2) 3px 3px 3px;-webkit-box-shadow:3px 3px 3px rgba(0,0,0,0.2);filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=3,OffY=3,Color=#16000000,Positive=true);} #g_minicart_login_close{position:absolute;right:5px;top:5px;width:17px;height:17px;background:url(http://img01.taobaocdn.com/tps/i1/T1krl0Xk8zXXXXXXXX-194-382.png) no-repeat -100px -69px;text-indent:-999em;overflow:hidden;}#g-cartlogin-close{cursor:pointer;position:absolute;right:5px;top:5px;width:17px;height:17px;line-height:0;overflow:hidden;background:url(http://img03.taobaocdn.com/tps/i1/T1k.tYXadGXXXXXXXX-146-77.png) no-repeat -132px 0;text-indent:-999em;}");this._stylesheetAdded=true}},_initPopup:function(){var i=f.DOM.create('<div id="g-cartlogin"></div>');f.DOM.append(i,f.DOM.get("body"));return i},_initLoginIframe:function(i){var K="https://login."+this.domain+"/member/login.jhtml?from=globalcart&style=mini&redirectURL="+encodeURIComponent(i)+"&full_redirect=true";this.popup.innerHTML='<iframe src="'+K+'" width="410" height="270" frameborder="0" scrolling="0"></iframe><span title="\u5173\u95ed" id="g-cartlogin-close">\u5173\u95ed</span>';f.Event.on("#g-cartlogin-close","click",this.hidePopup,this);this.showPopup()}});function F(K){if(e.userCookie&&!f.isUndefined(e.userCookie[K])){return e.userCookie[K]}if(f.isUndefined(E[K])){var i=I.cookie.match("(?:^|;)\\s*"+K+"=([^;]*)");E[K]=(i&&i[1])?decodeURIComponent(i[1]):H}return E[K]}function w(K){var L=I.createElement("div"),i=I.createTextNode(K);L.appendChild(i);return L.innerHTML}function G(S,T,K){var M=K.getElementsByTagName(T||"*"),Q=[],O=0,N=0,P=M.length,L,R;S=l+S+l;for(;O<P;++O){L=M[O];R=L.className;if(R&&(l+R+l).indexOf(S)>-1){Q[N++]=L}}return Q}function y(M,L,K,i){if(!M){return}if(M.addEventListener){M.addEventListener(L,K,!!i)}else{if(M.attachEvent){M.attachEvent("on"+L,K)}}}function B(M,L,K,i){if(!M){return}if(M.removeEventListener){M.removeEventListener(L,K,!!i)}else{if(M.detachEvent){M.detachEvent("on"+L,K)}}}function o(L,i){var K=l+L.className+l;if(K.indexOf(l+i+l)===-1){K+=i;L.className=f.trim(K)}}function r(L,i){var K=l+L.className+l;if(K.indexOf(l+i+l)!==-1){K=K.replace(l+i+l,l);L.className=f.trim(K)}}function g(i){if(e.userCookie&&e.userCookie.version=="2"){return f.unparam(i,"&amp;")}return f.unparam(i)}function h(i){if(i.preventDefault){i.preventDefault()}else{i.returnValue=false}}});